<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–æ³¨åŒ–ROIè¨ˆç®—ãƒ„ãƒ¼ãƒ« - ç›´æ„Ÿçš„ã‚¬ã‚¤ãƒ‰ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db; --secondary-color: #2ecc71; --danger-color: #e74c3c;
            --warning-color: #f39c12; --dark-color: #2c3e50; --light-color: #ecf0f1;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        body {
            font-family: 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', sans-serif;
            background-color: #f4f7f9; color: #333; line-height: 1.6; margin: 0; padding: 10px;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .header { text-align: center; padding: 15px; background: var(--bg-gradient); color: white; border-radius: 12px; margin-bottom: 15px; }
        .header h1 { font-size: 2.2em; margin: 0; }
        .main-grid { display: grid; grid-template-columns: 1fr 1.3fr; gap: 25px; }
        .input-section, .results-section { padding: 20px; border-radius: 12px; background: #fff; }
        .section-title { font-size: 1.4em; font-weight: bold; color: var(--dark-color); margin-bottom: 15px; padding-bottom: 8px; border-bottom: 3px solid var(--primary-color); }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-group { margin-bottom: 0; position: relative; }
        .input-group.full-width { grid-column: 1 / -1; }
        .input-label { display: flex; align-items: center; font-weight: 600; color: #555; margin-bottom: 6px; }
        .help-icon { margin-left: 8px; cursor: pointer; color: var(--primary-color); position: relative; }
        .tooltip { position: absolute; background: var(--dark-color); color: white; padding: 10px; border-radius: 6px; font-size: 0.85em; width: 280px; z-index: 1000; bottom: 25px; left: 0; opacity: 0; pointer-events: none; transition: opacity 0.3s; line-height: 1.4; }
        .help-icon:hover .tooltip { opacity: 1; }
        .input-field { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 1em; transition: all 0.3s; box-sizing: border-box; }
        .input-field:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); outline: none; }
        .calculate-btn { width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s; margin-top: 15px; }
        .calculate-btn:hover { background: #2980b9; transform: translateY(-2px); }
        .scenario-tabs { display: flex; margin-bottom: 12px; background: var(--light-color); border-radius: 10px; padding: 5px; }
        .scenario-tab { flex: 1; padding: 10px; background: transparent; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 0.95em; }
        .scenario-tab.active { background: white; color: var(--primary-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 15px; }
        .result-card { padding: 16px; border-radius: 12px; text-align: center; border: 1px solid #e0e0e0; background: #fdfdfd; }
        .result-number { font-size: 1.7em; font-weight: bold; margin-bottom: 4px; }
        .result-label { font-size: 0.85em; color: #666; }
        .result-card.positive .result-number { color: var(--secondary-color); }
        .result-card.negative .result-number { color: var(--danger-color); }
        .chart-container { margin-top: 15px; height: 300px; }
        .recommendations { margin-top: 20px; padding: 20px; border-radius: 12px; background: #f8f9fa; border-left: 5px solid var(--primary-color); }
        .recommendations ul { list-style: none; padding: 0; margin: 0; }
        .recommendations li { display: flex; align-items: flex-start; margin-bottom: 12px; font-size: 1em; }
        .recommendations .icon { font-size: 1.3em; margin-right: 12px; min-width: 25px; text-align: center; margin-top: 2px; }
        .icon-good { color: var(--secondary-color); } .icon-bad { color: var(--danger-color); } .icon-check { color: var(--warning-color); }
        .scenario-explanation { background: #e9f5ff; border: 1px solid #b3d7f5; padding: 12px; margin-top: 12px; border-radius: 8px; font-size: 0.95em; }
        .outsourcing-details { background: #f0f8f0; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .calculation-row { display: grid; grid-template-columns: 2fr 1fr 2fr; gap: 10px; align-items: center; margin-bottom: 8px; }
        .operator { text-align: center; font-weight: bold; color: var(--primary-color); }
        .guide-section { background: #fff9e6; border: 1px solid #f1c40f; padding: 12px; border-radius: 8px; margin-top: 8px; font-size: 0.9em; }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .input-grid { grid-template-columns: 1fr; } }
        @media print { .container { box-shadow: none; margin: 0; padding: 10px; } .header { margin-bottom: 10px; } .chart-container { height: 250px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-pie"></i> å¤–æ³¨åŒ–ROIè¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
            <p>ç›´æ„Ÿçš„ãªæ•°å€¤è¨­å®šã¨ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã§ã€ç¢ºå®ŸãªæŠ•è³‡åˆ¤æ–­ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™</p>
        </div>

        <div class="main-grid">
            <div class="input-section">
                <div class="section-title">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š</div>
                <div class="scenario-tabs">
                    <button class="scenario-tab" onclick="switchScenario('conservative', this)">ä¿å®ˆçš„</button>
                    <button class="scenario-tab active" onclick="switchScenario('realistic', this)">ç¾å®Ÿçš„</button>
                    <button class="scenario-tab" onclick="switchScenario('optimistic', this)">æ¥½è¦³çš„</button>
                </div>
                <div id="scenario-explanation" class="scenario-explanation"></div>

                <div class="section-title" style="margin-top:20px;">ç¾åœ¨ã®çŠ¶æ³</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label">
                            æœˆé–“å£²ä¸Š
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">ç¾åœ¨ã®æœˆé–“ç·å£²ä¸Šé«˜ã§ã™ã€‚ä¾‹ï¼šã‚³ãƒ³ã‚µãƒ«æ¥­ãªã‚‰æœˆ200ä¸‡å††ã€ECäº‹æ¥­ãªã‚‰æœˆ100ä¸‡å††ãªã©ã€æ¥­ç¨®ã«å¿œã˜ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="currentRevenue" class="input-field" value="2000000">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            æœˆé–“çµŒè²»
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">å®¶è³ƒã€é€šä¿¡è²»ã€ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™ãªã©ã€å¤–æ³¨è²»ä»¥å¤–ã®æœˆé–“å›ºå®šè²»ãƒ»å¤‰å‹•è²»ã®åˆè¨ˆã§ã™ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="currentExpenses" class="input-field" value="400000">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            æœˆé–“ä½œæ¥­æ™‚é–“
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">ã‚ãªãŸãŒç¾åœ¨äº‹æ¥­ã«è²»ã‚„ã—ã¦ã„ã‚‹æœˆé–“ç·æ™‚é–“æ•°ã§ã™ã€‚é€±40æ™‚é–“ãªã‚‰æœˆ160æ™‚é–“ç¨‹åº¦ãŒç›®å®‰ã§ã™ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="currentWorkHours" class="input-field" value="160">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            ã‚ãªãŸã®æ™‚çµ¦ä¾¡å€¤
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">ã‚ãªãŸã®1æ™‚é–“å½“ãŸã‚Šã®ä¾¡å€¤ã§ã™ã€‚æœˆåˆ©ç›ŠÃ·ä½œæ¥­æ™‚é–“ã€ã¾ãŸã¯ç†æƒ³æ™‚çµ¦ï¼ˆ5,000-15,000å††ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="hourlyValue" class="input-field" value="10000">
                    </div>
                </div>

                <div class="section-title" style="margin-top:20px;">å¤–æ³¨åŒ–è¨ˆç”»</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label">
                            å‰Šæ¸›äºˆå®šã®ä½œæ¥­æ™‚é–“
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">å¤–æ³¨ã«ã‚ˆã‚Šå‰Šæ¸›ã§ãã‚‹æœˆé–“ä½œæ¥­æ™‚é–“ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãªã‚‰æœˆ80æ™‚é–“ã€è¨˜äº‹ä½œæˆãªã‚‰æœˆ40æ™‚é–“ãªã©ã€å…·ä½“çš„ãªæ¥­å‹™ã‚’æƒ³å®šã—ã¦ãã ã•ã„ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="outsourcedHours" class="input-field" value="60">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            å¤–æ³¨è²»ç”¨ï¼ˆå›ºå®šï¼‰
                            <i class="fas fa-question-circle help-icon">
                                <div class="tooltip">æœˆé¡å›ºå®šã®å¤–æ³¨è²»ã§ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™ã€ç®¡ç†è²»ã€æœ€ä½ä¿è¨¼è²»ç”¨ãªã©ã‚’å«ã¿ã¾ã™ã€‚0å††ã®å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚</div>
                            </i>
                        </label>
                        <input type="number" id="outsourcingCostFixed" class="input-field" value="50000">
                    </div>
                </div>

                <div class="outsourcing-details">
                    <strong>å¤–æ³¨è²»ç”¨ï¼ˆå¤‰å‹•ï¼‰ã®è©³ç´°è¨­å®š</strong>
                    <div class="calculation-row">
                        <div>
                            <label class="input-label">å¤–æ³¨è€…æ™‚çµ¦</label>
                            <input type="number" id="hourlyRate" class="input-field" value="2000">
                        </div>
                        <div class="operator">Ã—</div>
                        <div>
                            <label class="input-label">æœˆé–“ç¨¼åƒæ™‚é–“</label>
                            <input type="number" id="workingHours" class="input-field" value="60">
                        </div>
                    </div>
                    <div class="calculation-row">
                        <div>
                            <label class="input-label">æ¡ˆä»¶å˜ä¾¡</label>
                            <input type="number" id="projectRate" class="input-field" value="5000">
                        </div>
                        <div class="operator">Ã—</div>
                        <div>
                            <label class="input-label">æœˆé–“æ¡ˆä»¶æ•°</label>
                            <input type="number" id="projectCount" class="input-field" value="4">
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <strong>å¤‰å‹•è²»åˆè¨ˆ: <span id="variableCostTotal">Â¥140,000</span></strong>
                    </div>
                </div>

                <div class="guide-section">
                    <strong>ğŸ’¡ å‰µå‡ºæ™‚é–“ã«ã‚ˆã‚‹å£²ä¸Šå‘ä¸Šã®è€ƒãˆæ–¹</strong><br>
                    å¤–æ³¨ã§æµ®ã„ãŸæ™‚é–“ã‚’ä½•ã«ä½¿ã†ã‹ã§å£²ä¸ŠãŒæ±ºã¾ã‚Šã¾ã™ï¼š<br>
                    â€¢ <strong>å–¶æ¥­æ´»å‹•</strong>: 60æ™‚é–“ Ã— æˆç´„ç‡ Ã— æ¡ˆä»¶å˜ä¾¡<br>
                    â€¢ <strong>æ–°ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™º</strong>: å£²ä¸Šã®10-30%å‘ä¸Šã‚’æœŸå¾…<br>
                    â€¢ <strong>æ—¢å­˜é¡§å®¢ãƒ•ã‚©ãƒ­ãƒ¼</strong>: ãƒªãƒ”ãƒ¼ãƒˆç‡å‘ä¸Šã§å£²ä¸Š20%ã‚¢ãƒƒãƒ—ãªã©<br>
                    <strong>è¨ˆç®—ä¾‹</strong>: æœˆ60æ™‚é–“ã§æ–°è¦å–¶æ¥­â†’2ä»¶æˆç´„Ã—50ä¸‡å††=100ä¸‡å††å£²ä¸Šå¢—
                </div>

                <div class="input-group full-width" style="margin-top: 15px;">
                    <label class="input-label">
                        å‰µå‡ºæ™‚é–“ã«ã‚ˆã‚‹å£²ä¸Šå‘ä¸Šé¡
                        <i class="fas fa-question-circle help-icon">
                            <div class="tooltip">æµ®ã„ãŸæ™‚é–“ã§å¢—ã‚„ã›ã‚‹å£²ä¸Šã§ã™ã€‚å–¶æ¥­ãªã‚‰æˆç´„é¡ã€é–‹ç™ºãªã‚‰æ–°åç›Šã€æ”¹å–„ãªã‚‰åŠ¹ç‡åŒ–ã«ã‚ˆã‚‹å¢—ååˆ†ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>
                        </i>
                    </label>
                    <input type="number" id="revenueIncrease" class="input-field" value="800000">
                </div>

                <button class="calculate-btn" onclick="calculate()"><i class="fas fa-calculator"></i> çµæœã‚’è¨ˆç®—ãƒ»æ›´æ–°</button>
            </div>

            <div class="results-section">
                <div class="section-title">è¨ˆç®—çµæœ</div>
                <div id="results-grid" class="results-grid"></div>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="profitTimelineChart"></canvas>
                </div>
            </div>
        </div>

        <div id="recommendations" class="recommendations" style="display:none;">
            <div class="section-title">ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
            <ul id="recommendation-list"></ul>
        </div>

    </div>

    <script>
        let comparisonChart, profitTimelineChart;
        let currentScenario = 'realistic';

        const scenarios = {
            conservative: { name: 'ä¿å®ˆçš„', revenueFactor: 0.7, costFactor: 1.2, explanation: '<strong>ã€ä¿å®ˆçš„ã€‘</strong> å£²ä¸Šå‘ä¸Šã¯æ§ãˆã‚ã«(x0.7)ã€ã‚³ã‚¹ãƒˆã¯å¤šã‚ã«(x1.2)è¦‹ç©ã‚‚ã‚‹å …å®Ÿãªäºˆæ¸¬ã€‚ãƒªã‚¹ã‚¯ã‚’é‡è¦–ã—ãŸåˆ¤æ–­ã«é©ã—ã¦ã„ã¾ã™ã€‚' },
            realistic: { name: 'ç¾å®Ÿçš„', revenueFactor: 1.0, costFactor: 1.0, explanation: '<strong>ã€ç¾å®Ÿçš„ã€‘</strong> å…¥åŠ›å€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹æ¨™æº–çš„ãªäºˆæ¸¬ã€‚æœ€ã‚‚å®Ÿç”¨çš„ãªåˆ¤æ–­åŸºæº–ã§ã™ã€‚' },
            optimistic: { name: 'æ¥½è¦³çš„', revenueFactor: 1.5, costFactor: 0.9, explanation: '<strong>ã€æ¥½è¦³çš„ã€‘</strong> å£²ä¸Šå‘ä¸Šã¯æœ€å¤§é™ã«(x1.5)ã€ã‚³ã‚¹ãƒˆã¯åŠ¹ç‡åŒ–ã‚’æœŸå¾…ã—(x0.9)è¦‹ç©ã‚‚ã‚‹ç†æƒ³çš„ãªã‚·ãƒŠãƒªã‚ªã€‚' }
        };

        function updateVariableCost() {
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 0;
            const workingHours = parseFloat(document.getElementById('workingHours').value) || 0;
            const projectRate = parseFloat(document.getElementById('projectRate').value) || 0;
            const projectCount = parseFloat(document.getElementById('projectCount').value) || 0;
            
            const total = (hourlyRate * workingHours) + (projectRate * projectCount);
            document.getElementById('variableCostTotal').textContent = `Â¥${total.toLocaleString()}`;
            return total;
        }

        function switchScenario(scenario, element) {
            currentScenario = scenario;
            document.querySelectorAll('.scenario-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            updateScenarioExplanation();
            calculate();
        }
        
        function updateScenarioExplanation() {
            document.getElementById('scenario-explanation').innerHTML = scenarios[currentScenario].explanation;
        }

        function calculate() {
            const inputs = {
                currentRevenue: parseFloat(document.getElementById('currentRevenue').value) || 0,
                currentExpenses: parseFloat(document.getElementById('currentExpenses').value) || 0,
                currentWorkHours: parseFloat(document.getElementById('currentWorkHours').value) || 0,
                hourlyValue: parseFloat(document.getElementById('hourlyValue').value) || 0,
                outsourcedHours: parseFloat(document.getElementById('outsourcedHours').value) || 0,
                revenueIncrease: parseFloat(document.getElementById('revenueIncrease').value) || 0,
                outsourcingCostFixed: parseFloat(document.getElementById('outsourcingCostFixed').value) || 0,
                outsourcingCostVariable: updateVariableCost(),
            };

            const scenario = scenarios[currentScenario];
            const totalOutsourcingCost = (inputs.outsourcingCostFixed + inputs.outsourcingCostVariable) * scenario.costFactor;
            const adjustedRevenueIncrease = inputs.revenueIncrease * scenario.revenueFactor;

            const before = {
                profit: inputs.currentRevenue - inputs.currentExpenses,
                workHours: inputs.currentWorkHours,
                revenue: inputs.currentRevenue,
                cost: inputs.currentExpenses
            };

            const after = {
                revenue: inputs.currentRevenue + adjustedRevenueIncrease,
                cost: inputs.currentExpenses + totalOutsourcingCost,
                workHours: inputs.currentWorkHours - inputs.outsourcedHours,
            };
            after.profit = after.revenue - after.cost;
            
            const investment = totalOutsourcingCost;
            const timeValueSaved = inputs.outsourcedHours * inputs.hourlyValue;
            const netProfitIncrease = after.profit - before.profit;
            const totalGain = netProfitIncrease + timeValueSaved;
            
            const roi = investment > 0 ? (totalGain / investment) * 100 : 0;
            const paybackPeriod = totalGain > 0 ? investment / totalGain : Infinity;

            displayResults({ roi, paybackPeriod, netProfitIncrease, timeValueSaved, totalGain, investment });
            updateCharts(before, after, totalGain, investment, adjustedRevenueIncrease, totalOutsourcingCost);
            generateRecommendations({ roi, paybackPeriod, netProfitIncrease, timeValueSaved });
            
            document.getElementById('recommendations').style.display = 'block';
        }

        function displayResults(data) {
            const grid = document.getElementById('results-grid');
            grid.innerHTML = `
                <div class="result-card ${data.roi > 0 ? 'positive' : 'negative'}">
                    <div class="result-number">${data.roi.toFixed(1)}%</div>
                    <div class="result-label">æŠ•è³‡åç›Šç‡ (ROI)</div>
                </div>
                <div class="result-card ${data.paybackPeriod <= 12 ? 'positive' : 'negative'}">
                    <div class="result-number">${isFinite(data.paybackPeriod) ? data.paybackPeriod.toFixed(1) : 'âˆ'}</div>
                    <div class="result-label">å›åæœŸé–“ (ãƒ¶æœˆ)</div>
                </div>
                <div class="result-card ${data.netProfitIncrease > 0 ? 'positive' : 'negative'}">
                    <div class="result-number">Â¥${Math.round(data.netProfitIncrease).toLocaleString()}</div>
                    <div class="result-label">æœˆé–“åˆ©ç›Šã®å¢—æ¸›</div>
                </div>
                <div class="result-card positive">
                    <div class="result-number">Â¥${Math.round(data.timeValueSaved).toLocaleString()}</div>
                    <div class="result-label">å‰µå‡ºæ™‚é–“ä¾¡å€¤</div>
                </div>
                <div class="result-card ${data.totalGain > 0 ? 'positive' : 'negative'}">
                    <div class="result-number">Â¥${Math.round(data.totalGain).toLocaleString()}</div>
                    <div class="result-label">æœˆé–“ç·ä¾¿ç›Š</div>
                </div>
            `;
        }

        function updateCharts(before, after, totalGain, investment, revenueIncrease, outsourcingCost) {
            // Before/Afteræ¯”è¼ƒã‚°ãƒ©ãƒ•
            const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();
            comparisonChart = new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['å£²ä¸Š', 'åˆ©ç›Š', 'ä½œæ¥­æ™‚é–“'],
                    datasets: [
                        {
                            label: 'Before',
                            data: [before.revenue, before.profit, before.workHours],
                            backgroundColor: 'rgba(231, 76, 60, 0.6)',
                            yAxisID: 'y1',
                        },
                        {
                            label: 'After',
                            data: [after.revenue, after.profit, after.workHours],
                            backgroundColor: 'rgba(52, 152, 219, 0.6)',
                            yAxisID: 'y1',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: 'Before/After æ¯”è¼ƒ', font: { size: 16 } } },
                    scales: {
                        y1: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'é‡‘é¡ (å††) / æ™‚é–“ (h)' }
                        }
                    }
                }
            });

            // 12ãƒ¶æœˆåç›Šäºˆæ¸¬ã‚°ãƒ©ãƒ•
            const timelineCtx = document.getElementById('profitTimelineChart').getContext('2d');
            if (profitTimelineChart) profitTimelineChart.destroy();
            
            let cumulativeRevenue = 0, cumulativeCost = 0, cumulativeProfit = 0;
            const revenueData = [0], costData = [0], profitData = [0];

            for (let i = 1; i <= 12; i++) {
                cumulativeRevenue += revenueIncrease;
                cumulativeCost += outsourcingCost;
                cumulativeProfit = cumulativeRevenue - cumulativeCost;
                revenueData.push(cumulativeRevenue);
                costData.push(cumulativeCost);
                profitData.push(cumulativeProfit);
            }

            profitTimelineChart = new Chart(timelineCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 13}, (_, i) => `${i}ãƒ¶æœˆå¾Œ`),
                    datasets: [
                        {
                            label: 'ç´¯è¨ˆå£²ä¸Šå‘ä¸Šé¡',
                            data: revenueData,
                            borderColor: 'rgb(52, 152, 219)',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: false,
                            tension: 0.1,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'ç´¯è¨ˆå¤–æ³¨ã‚³ã‚¹ãƒˆ',
                            data: costData,
                            borderColor: 'rgb(231, 76, 60)',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: false,
                            tension: 0.1,
                            borderDash: [3, 3]
                        },
                        {
                            label: 'ç´¯è¨ˆç´”åˆ©ç›Š',
                            data: profitData,
                            borderColor: 'rgb(46, 204, 113)',
                            backgroundColor: 'rgba(46, 204, 113, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        title: { display: true, text: '12ãƒ¶æœˆé–“ã®åç›Šæ§‹æˆäºˆæ¸¬', font: { size: 16 } },
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: 'ç´¯è¨ˆé‡‘é¡ (å††)' }
                        }
                    }
                }
            });
        }

        function generateRecommendations(data) {
            const list = document.getElementById('recommendation-list');
            list.innerHTML = '';
            let recommendations = [];

            if (data.roi > 200) {
                recommendations.push({ icon: 'fa-rocket icon-good', text: '<strong>å³æ™‚å®Ÿè¡Œã‚’å¼·ãæ¨å¥¨</strong>: ROIãŒ200%è¶…ã¨éå¸¸ã«é«˜ãã€ãƒªã‚¹ã‚¯ãŒæ¥µã‚ã¦ä½ã„æŠ•è³‡ã§ã™ã€‚ç›´ã¡ã«å®Ÿè¡Œè¨ˆç”»ã‚’ç«‹ã¦ã€å¯èƒ½ãªé™ã‚Šæ—©æœŸã«é–‹å§‹ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚' });
            } else if (data.roi > 100) {
                recommendations.push({ icon: 'fa-thumbs-up icon-good', text: '<strong>ç©æ¥µçš„ãªå®Ÿè¡Œã‚’æ¨å¥¨</strong>: ROI100%è¶…ã§éå¸¸ã«å¥å…¨ãªæŠ•è³‡ã§ã™ã€‚å°è¦æ¨¡ãªãƒ†ã‚¹ãƒˆã‹ã‚‰å§‹ã‚ã¦åŠ¹æœã‚’ç¢ºèªå¾Œã€æœ¬æ ¼å±•é–‹ã—ã¦ãã ã•ã„ã€‚' });
            } else if (data.roi > 50) {
                recommendations.push({ icon: 'fa-check-circle icon-good', text: '<strong>å®Ÿè¡Œã‚’æ¨å¥¨</strong>: ååˆ†ãªãƒªã‚¿ãƒ¼ãƒ³ãŒæœŸå¾…ã§ãã¾ã™ã€‚ãƒªã‚¹ã‚¯ç®¡ç†ã‚’ã—ãªãŒã‚‰æ®µéšçš„ã«é€²ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚' });
            } else if (data.roi > 0) {
                recommendations.push({ icon: 'fa-exclamation-triangle icon-check', text: '<strong>æ…é‡ã«æ¤œè¨</strong>: åç›Šæ€§ã¯ç¢ºä¿ã•ã‚Œã¦ã„ã¾ã™ãŒã€æŠ•è³‡åŠ¹æœãŒé™å®šçš„ã§ã™ã€‚å¤–æ³¨ã‚³ã‚¹ãƒˆã®å‰Šæ¸›ã‚„å£²ä¸Šå‘ä¸Šç­–ã®è¦‹ç›´ã—ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚' });
            } else {
                recommendations.push({ icon: 'fa-times-circle icon-bad', text: '<strong>ç¾æ™‚ç‚¹ã§ã¯å®Ÿè¡Œéæ¨å¥¨</strong>: ç¾åœ¨ã®æ¡ä»¶ã§ã¯æŠ•è³‡åŠ¹æœãŒæœŸå¾…ã§ãã¾ã›ã‚“ã€‚å¤–æ³¨å†…å®¹ã‚„è²»ç”¨æ§‹é€ ã®å¤§å¹…ãªè¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚' });
            }

            if (isFinite(data.paybackPeriod)) {
                if (data.paybackPeriod <= 3) {
                    recommendations.push({ icon: 'fa-bolt icon-good', text: '<strong>è¶…çŸ­æœŸå›å</strong>: 3ãƒ¶æœˆä»¥å†…ã®æŠ•è³‡å›åã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã¸ã®å½±éŸ¿ã¯è»½å¾®ã§ã™ã€‚ç©æ¥µçš„ãªæŠ•è³‡æ‹¡å¤§ã‚‚æ¤œè¨ã§ãã¾ã™ã€‚' });
                } else if (data.paybackPeriod <= 6) {
                    recommendations.push({ icon: 'fa-check-circle icon-good', text: '<strong>çŸ­æœŸå›å</strong>: åŠå¹´ä»¥å†…ã®å›åã§éå¸¸ã«å¥å…¨ã§ã™ã€‚å®‰å¿ƒã—ã¦æŠ•è³‡ã‚’é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚' });
                } else if (data.paybackPeriod <= 12) {
                    recommendations.push({ icon: 'fa-clock icon-check', text: '<strong>ä¸­æœŸå›å</strong>: 1å¹´ä»¥å†…ã®å›åã§ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ç®¡ç†ã«æ³¨æ„ã—ãªãŒã‚‰é€²ã‚ã¦ãã ã•ã„ã€‚' });
                } else {
                    recommendations.push({ icon: 'fa-hourglass icon-check', text: '<strong>é•·æœŸå›å</strong>: å›åã«1å¹´ä»¥ä¸Šã‹ã‹ã‚Šã¾ã™ã€‚æœˆã€…ã®å¤–æ³¨ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã™ã‚‹å·¥å¤«ãŒé‡è¦ã§ã™ã€‚' });
                }
            }

            if (data.timeValueSaved > 500000) {
                recommendations.push({ icon: 'fa-star icon-good', text: '<strong>é«˜ã„æ™‚é–“ä¾¡å€¤å‰µå‡º</strong>: æœˆ50ä¸‡å††ä»¥ä¸Šã®æ™‚é–“ä¾¡å€¤ã‚’å‰µå‡ºã§ãã¾ã™ã€‚ã“ã®æ™‚é–“ã‚’æˆ¦ç•¥çš„æ¥­å‹™ã«é›†ä¸­æŠ•ä¸‹ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹æˆé•·ãŒæœŸå¾…ã§ãã¾ã™ã€‚' });
            } else if (data.timeValueSaved > 200000) {
                recommendations.push({ icon: 'fa-clock icon-good', text: '<strong>é©åˆ‡ãªæ™‚é–“ä¾¡å€¤å‰µå‡º</strong>: æœˆ20ä¸‡å††ä»¥ä¸Šã®æ™‚é–“ä¾¡å€¤å‰µå‡ºã§ã€å¤–æ³¨æŠ•è³‡ã®æ„ç¾©ã¯ååˆ†ã«ã‚ã‚Šã¾ã™ã€‚' });
            }
            
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas ${rec.icon}"></i><div>${rec.text}</div>`;
                list.appendChild(li);
            });
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
            updateScenarioExplanation();
            
            // å¤–æ³¨è²»ç”¨ã®å¤‰å‹•è¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            ['hourlyRate', 'workingHours', 'projectRate', 'projectCount'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    updateVariableCost();
                    calculate();
                });
            });
            
            // ãã®ä»–ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            ['currentRevenue', 'currentExpenses', 'currentWorkHours', 'hourlyValue', 'outsourcedHours', 'revenueIncrease', 'outsourcingCostFixed'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculate);
            });
            
            calculate();
        });
    </script>
</body>
</html>